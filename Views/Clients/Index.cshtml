@model IEnumerable<Library_MVC.Models.Client>

@{
    ViewBag.Title = "Index";
}

<h2>Clients</h2>

<p>
    @if (User.IsInRole("Administrator") || User.IsInRole("Librarian"))
    {
        @Html.ActionLink("Create New", "Create")
    }
</p>
<table class="table" id="clientsTable">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.LibraryCard)
            </th>

            <th>
                @Html.DisplayNameFor(model => model.Name)

            </th>
            <th>
                @Html.DisplayNameFor(model => model.Address)
            </th>

           
            <th></th>
        </tr>
    </thead>

    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.LibraryCard)
            </td>

            <td>
                @Html.ActionLink(item.Name, "Details", new { id = item.ClientId })

            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Address)
            </td>

           
            <td>
                    @if (User.IsInRole("Administrator") || User.IsInRole("Librarian"))
                    {
                        @Html.ActionLink("Edit", "Edit", new { id = item.ClientId })
                    }|


                    @if (User.IsInRole("Administrator") || User.IsInRole("Librarian"))
                    {
                        <button class="btn-link js-delete" data-id="@item.ClientId">Delete</button>
                    }

                    <br />

                    @if (User.IsInRole("Administrator") || User.IsInRole("Librarian"))
                    {
                        @Html.ActionLink("Add Book", "AddBookToClient", new { id = item.ClientId })

                    }|

                    @if (User.IsInRole("Administrator") || User.IsInRole("Librarian"))
                    {
                        @Html.ActionLink("Remove Book", "RemoveBookFromClient", new { id = item.ClientId })

                    }
                </td>
        </tr>
        }
    </tbody>

</table>



@section scripts{
    <script>
        var table = $("#clientsTable").DataTable();  //ovaa linija ni e potrebna za JqueryDataTables

        // ova ni e potrebno za brishenje so AJAX
        $("#clientsTable .js-delete").click(function () {
            var button = $(this);                             // referenca /cel objekt ako e so $, do selektiranoto kopche za brishenje,kade kako atrib. go imame id-to na filmot
            bootbox.confirm("Are you sure you want to delete the client?",
                function (result) {
                    if (result) {
                        $.ajax({
                            method: "GET", //"DELETE",
                            url: "/Clients/Delete/" + button.attr("data-id"),
                            success: function (result) {
                                table.row(button.parents("tr")).remove().draw();
                            }
                        });
                    }

                });
        });

    </script>

}